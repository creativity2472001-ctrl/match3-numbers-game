<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© - Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ·Ø§Ø¨Ù‚</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a2a3a, #0f1a24);
            padding: 15px;
        }

        .game-container {
            background: linear-gradient(145deg, #2a3f4a, #1a2a35);
            border-radius: 60px;
            padding: 25px;
            box-shadow: 0 30px 50px rgba(0,0,0,0.8), inset 0 0 30px rgba(255,215,0,0.2);
            max-width: 800px;
            width: 100%;
            border: 5px solid #ffd700;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.5);
            padding: 15px 25px;
            border-radius: 50px;
            border: 3px solid #ffd700;
        }

        .level-box {
            background: linear-gradient(145deg, #ffd700, #b8860b);
            color: #1a2a35;
            padding: 12px 35px;
            border-radius: 50px;
            font-size: 28px;
            font-weight: bold;
            box-shadow: inset 0 -5px 0 #8b6508;
        }

        .score-box {
            background: #1a2a35;
            color: #ffd700;
            padding: 12px 35px;
            border-radius: 50px;
            font-size: 28px;
            font-weight: bold;
            border: 3px solid #ffd700;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #0f1a24;
            border-radius: 50px;
            margin: 20px 0;
            border: 3px solid #ffd700;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffaa00);
            width: 0%;
            transition: width 0.3s;
        }

        /* Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .boosters-panel {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
        }

        .booster-slot {
            width: 90px;
            height: 90px;
            background: #1a2a35;
            border-radius: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 3px solid #ffd700;
            position: relative;
        }

        .booster-slot .count {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ffd700;
            color: #1a2a35;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            border: 2px solid white;
        }

        .booster-icon {
            font-size: 40px;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        .board-wrapper {
            background: #0f1a24;
            padding: 25px;
            border-radius: 60px;
            border: 4px solid #ffd700;
            margin-bottom: 25px;
        }

        .board {
            display: inline-grid;
            gap: 10px;
            justify-content: center;
            width: 100%;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø¹Ø¯Ù†ÙŠØ© */
        .cell {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #ffd700, #b8860b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: #1a2a35;
            text-shadow: 0 2px 5px rgba(255,255,255,0.5);
            box-shadow: 0 8px 0 #8b6508, 0 10px 20px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: 0.05s;
            border: 3px solid #ffaa00;
        }

        .cell:active {
            transform: scale(0.95);
        }

        .cell.selected {
            transform: scale(1.1);
            box-shadow: 0 0 0 6px #ffd700, 0 8px 0 #8b6508, 0 15px 25px black;
            z-index: 10;
        }

        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
        .num-1 { background: radial-gradient(circle at 35% 35%, #ffb3b3, #ff4d4d); }
        .num-2 { background: radial-gradient(circle at 35% 35%, #b3ffb3, #4dff4d); }
        .num-3 { background: radial-gradient(circle at 35% 35%, #b3b3ff, #4d4dff); }
        .num-4 { background: radial-gradient(circle at 35% 35%, #ffb3ff, #ff4dff); }
        .num-5 { background: radial-gradient(circle at 35% 35%, #ffffb3, #ffff4d); }
        .num-6 { background: radial-gradient(circle at 35% 35%, #ffd9b3, #ffaa4d); }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .booster-piece {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            cursor: pointer;
            animation: boosterAppear 0.3s;
            box-shadow: 0 0 30px gold;
            border: 4px solid white;
        }

        .booster-piece.arrow {
            background: radial-gradient(circle at 35% 35%, #ffaa4d, #ff6b4d);
        }

        .booster-piece.bomb {
            background: radial-gradient(circle at 35% 35%, #4d4d4d, #1a1a1a);
        }

        @keyframes boosterAppear {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes matchPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); filter: brightness(1.5); }
            100% { transform: scale(0); opacity: 0; }
        }

        .cell.matching {
            animation: matchPop 0.2s ease forwards;
            pointer-events: none;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ² */
        .victory-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            border-radius: 60px;
        }

        .victory-content {
            background: linear-gradient(145deg, #ffd700, #b8860b);
            padding: 50px;
            border-radius: 80px;
            text-align: center;
            color: #1a2a35;
            border: 5px solid white;
        }

        .victory-content h1 {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .victory-content button {
            background: #1a2a35;
            color: #ffd700;
            border: none;
            padding: 20px 50px;
            font-size: 32px;
            border-radius: 60px;
            cursor: pointer;
            margin-top: 30px;
            border: 3px solid white;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ */
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }

        .nav-btn {
            background: linear-gradient(145deg, #1a2a35, #0f1a24);
            border: 3px solid #ffd700;
            color: #ffd700;
            font-size: 24px;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.05s;
            box-shadow: 0 6px 0 #0a1219;
            flex: 1;
            max-width: 180px;
            text-align: center;
        }

        .nav-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #0a1219;
        }

        .nav-btn.disabled {
            opacity: 0.3;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="header">
            <div class="level-box" id="levelDisplay">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1</div>
            <div class="score-box" id="scoreDisplay">0</div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
        <div class="board-wrapper">
            <div class="board" id="board"></div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ² -->
        <div class="victory-screen" id="victoryScreen">
            <div class="victory-content">
                <h1>ğŸ‰ Ø§Ù†ØªØµØ±Øª! ğŸ‰</h1>
                <div style="font-size: 48px; margin: 20px 0;" id="victoryTarget"></div>
                <button onclick="goToNextLevel()">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â–¶</button>
            </div>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <div class="nav-buttons">
            <div class="nav-btn" onclick="prevLevel()" id="prevBtn">â—€ Ø±Ø¬ÙˆØ¹</div>
            <div class="nav-btn" onclick="resetLevel()">Ø¥Ø¹Ø§Ø¯Ø©</div>
            <div class="nav-btn" onclick="nextLevel()" id="nextBtn">ØªØ§Ù„ÙŠ â–¶</div>
        </div>
    </div>

    <script>
        // ------------------------------------------------------------
        //                     Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        // ------------------------------------------------------------

        // Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© (ÙƒÙ„ Ø±Ù‚Ù… ÙŠÙ…Ø«Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…Ù„Ø©)
        const NUMBERS = [1, 2, 3, 4, 5, 6];

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let currentLevel = 0;
        let board = [];
        let score = 0;
        let selectedRow = -1, selectedCol = -1;
        let gamePaused = false;

        // Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©
        let boardBoosters = []; // { row, col, type }

        // Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©
        let completedLevels = JSON.parse(localStorage.getItem('completedLevels')) || [];

        // ------------------------------------------------------------
        //                     ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
        // ------------------------------------------------------------
        const levels = [
            // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: 6x6, Ø£Ø±Ù‚Ø§Ù… 1-3, Ù‡Ø¯Ù 100
            { id: 1, rows: 6, cols: 6, maxNumber: 3, target: 100 },
            // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: 6x6, Ø£Ø±Ù‚Ø§Ù… 1-3, Ù‡Ø¯Ù 150
            { id: 2, rows: 6, cols: 6, maxNumber: 3, target: 150 },
            // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: 6x6, Ø£Ø±Ù‚Ø§Ù… 1-4, Ù‡Ø¯Ù 200
            { id: 3, rows: 6, cols: 6, maxNumber: 4, target: 200 },
            // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: 6x6, Ø£Ø±Ù‚Ø§Ù… 1-4, Ù‡Ø¯Ù 250
            { id: 4, rows: 6, cols: 6, maxNumber: 4, target: 250 },
            // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: 7x7, Ø£Ø±Ù‚Ø§Ù… 1-5, Ù‡Ø¯Ù 350
            { id: 5, rows: 7, cols: 7, maxNumber: 5, target: 350 },
            // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: 7x7, Ø£Ø±Ù‚Ø§Ù… 1-5, Ù‡Ø¯Ù 400
            { id: 6, rows: 7, cols: 7, maxNumber: 5, target: 400 },
            // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 7: 7x7, Ø£Ø±Ù‚Ø§Ù… 1-6, Ù‡Ø¯Ù 500
            { id: 7, rows: 7, cols: 7, maxNumber: 6, target: 500 },
            // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 8: 8x8, Ø£Ø±Ù‚Ø§Ù… 1-6, Ù‡Ø¯Ù 600
            { id: 8, rows: 8, cols: 8, maxNumber: 6, target: 600 }
        ];

        // ------------------------------------------------------------
        //                     Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙˆØ­Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        // ------------------------------------------------------------
        function createBoard(level) {
            let newBoard = [];
            let availableNumbers = NUMBERS.slice(0, level.maxNumber);
            
            for (let r = 0; r < level.rows; r++) {
                let row = [];
                for (let c = 0; c < level.cols; c++) {
                    let randomNum = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
                    row.push(randomNum);
                }
                newBoard.push(row);
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªØ·Ø§Ø¨Ù‚Ø§Øª Ø£ÙˆÙ„ÙŠØ©
            while (hasInitialMatches(newBoard)) {
                for (let r = 0; r < level.rows; r++) {
                    for (let c = 0; c < level.cols; c++) {
                        let randomNum = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
                        newBoard[r][c] = randomNum;
                    }
                }
            }
            
            return newBoard;
        }

        function hasInitialMatches(board) {
            let rows = board.length, cols = board[0].length;
            
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols - 2; c++) {
                    if (board[r][c] === board[r][c+1] && board[r][c] === board[r][c+2]) {
                        return true;
                    }
                }
            }
            
            for (let c = 0; c < cols; c++) {
                for (let r = 0; r < rows - 2; r++) {
                    if (board[r][c] === board[r+1][c] && board[r][c] === board[r+2][c]) {
                        return true;
                    }
                }
            }
            
            return false;
        }

        // ------------------------------------------------------------
        //                     Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ·Ø§Ø¨Ù‚Ø§Øª
        // ------------------------------------------------------------
        function checkMatches(board) {
            let matches = [];
            let matchGroups = [];
            let rows = board.length, cols = board[0].length;
            let processed = Array(rows).fill().map(() => Array(cols).fill(false));

            // Ø£ÙÙ‚ÙŠ
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols - 2; c++) {
                    let val = board[r][c];
                    if (val === null) continue;
                    
                    let len = 1;
                    while (c + len < cols && board[r][c + len] === val) len++;
                    
                    if (len >= 3) {
                        let group = [];
                        for (let i = 0; i < len; i++) {
                            if (!processed[r][c + i]) {
                                group.push([r, c + i]);
                                processed[r][c + i] = true;
                            }
                        }
                        if (group.length >= 3) {
                            matchGroups.push({
                                cells: group,
                                value: val,
                                length: len,
                                startRow: r,
                                startCol: c
                            });
                            matches.push(...group);
                        }
                    }
                    c += len - 1;
                }
            }

            // Ø¹Ù…ÙˆØ¯ÙŠ
            processed = Array(rows).fill().map(() => Array(cols).fill(false));
            for (let c = 0; c < cols; c++) {
                for (let r = 0; r < rows - 2; r++) {
                    let val = board[r][c];
                    if (val === null) continue;
                    
                    let len = 1;
                    while (r + len < rows && board[r + len][c] === val) len++;
                    
                    if (len >= 3) {
                        let group = [];
                        for (let i = 0; i < len; i++) {
                            if (!processed[r + i][c]) {
                                group.push([r + i, c]);
                                processed[r + i][c] = true;
                            }
                        }
                        if (group.length >= 3) {
                            matchGroups.push({
                                cells: group,
                                value: val,
                                length: len,
                                startRow: r,
                                startCol: c
                            });
                            matches.push(...group);
                        }
                    }
                    r += len - 1;
                }
            }

            return { matches, matchGroups };
        }

        // ------------------------------------------------------------
        //                     Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ·Ø§Ø¨Ù‚Ø§Øª
        // ------------------------------------------------------------
        async function removeMatchesAndDrop(board, matches, matchGroups) {
            if (gamePaused) return;
            
            let level = levels[currentLevel];
            let rows = board.length, cols = board[0].length;
            let totalPoints = 0;
            let newBoosters = [];

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· (Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø©)
            matchGroups.forEach(group => {
                let sum = group.cells.length * group.value;
                totalPoints += sum;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø²Ø²Ø§Øª
                if (group.length === 4) {
                    // ØªØ·Ø§Ø¨Ù‚ 4 â†’ Ø³Ù‡Ù…
                    let centerRow = group.startRow;
                    let centerCol = group.startCol + Math.floor(group.length / 2);
                    newBoosters.push({
                        row: centerRow,
                        col: centerCol,
                        type: 'arrow',
                        direction: group.hasOwnProperty('startRow') ? 'horizontal' : 'vertical'
                    });
                } else if (group.length >= 5) {
                    // ØªØ·Ø§Ø¨Ù‚ 5 â†’ Ù‚Ù†Ø¨Ù„Ø©
                    let centerRow = group.startRow + Math.floor(group.cells.length / 2);
                    let centerCol = group.startCol + Math.floor(group.cells.length / 2);
                    newBoosters.push({
                        row: centerRow,
                        col: centerCol,
                        type: 'bomb'
                    });
                }
            });

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·
            score += totalPoints;
            updateProgress();

            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø±
            let cells = document.querySelectorAll('.cell');
            matches.forEach(([r, c]) => {
                let index = r * cols + c;
                if (cells[index]) cells[index].classList.add('matching');
            });

            await new Promise(resolve => setTimeout(resolve, 200));

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø©
            let removed = Array(rows).fill().map(() => Array(cols).fill(false));
            matches.forEach(([r, c]) => {
                board[r][c] = null;
                removed[r][c] = true;
            });

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            newBoosters.forEach(booster => {
                boardBoosters.push(booster);
            });

            // Ø¥Ø³Ù‚Ø§Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
            for (let c = 0; c < cols; c++) {
                for (let r = rows - 1; r >= 0; r--) {
                    if (removed[r][c]) {
                        // Ø¥Ø³Ù‚Ø§Ø· Ù…Ù† ÙÙˆÙ‚
                        for (let k = r - 1; k >= 0; k--) {
                            if (board[k][c] !== null && !removed[k][c]) {
                                board[r][c] = board[k][c];
                                board[k][c] = null;
                                removed[k][c] = true;
                                removed[r][c] = false;
                                break;
                            }
                        }
                        // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø±Ù‚Ù…ØŒ Ù†Ù†Ø´Ø¦ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯
                        if (removed[r][c]) {
                            let availableNumbers = NUMBERS.slice(0, level.maxNumber);
                            board[r][c] = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
                        }
                    }
                }
            }

            renderBoard();

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
            await new Promise(resolve => setTimeout(resolve, 300));
            let { matches: newMatches, matchGroups: newGroups } = checkMatches(board);
            if (newMatches.length > 0) {
                await removeMatchesAndDrop(board, newMatches, newGroups);
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙÙˆØ²
            if (score >= level.target && !completedLevels.includes(currentLevel)) {
                gamePaused = true;
                completedLevels.push(currentLevel);
                localStorage.setItem('completedLevels', JSON.stringify(completedLevels));
                document.getElementById('victoryTarget').textContent = `Ù‡Ø¯ÙÙƒ: ${level.target} Ù†Ù‚Ø·Ø©`;
                document.getElementById('victoryScreen').style.display = 'flex';
            }
        }

        // ------------------------------------------------------------
        //                     Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª
        // ------------------------------------------------------------
        function useBoosterFromBoard(row, col, booster) {
            let index = boardBoosters.findIndex(b => b.row === row && b.col === col);
            if (index === -1) return;
            
            boardBoosters.splice(index, 1);
            
            if (booster.type === 'arrow') {
                useArrow(booster.row, booster.col, booster.direction);
            } else if (booster.type === 'bomb') {
                useBomb(booster.row, booster.col);
            }
        }

        function useArrow(row, col, direction) {
            let rows = board.length, cols = board[0].length;
            let points = 0;
            
            if (direction === 'horizontal') {
                for (let c = 0; c < cols; c++) {
                    if (board[row][c] !== null) {
                        points += board[row][c];
                        board[row][c] = null;
                    }
                }
            } else {
                for (let r = 0; r < rows; r++) {
                    if (board[r][col] !== null) {
                        points += board[r][col];
                        board[r][col] = null;
                    }
                }
            }
            
            score += points;
            updateProgress();
            showMessage(`ğŸ¯ +${points}`);
            renderBoard();
            
            // Ø¥Ø³Ù‚Ø§Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            setTimeout(async () => {
                let { matches, matchGroups } = checkMatches(board);
                if (matches.length > 0) {
                    await removeMatchesAndDrop(board, matches, matchGroups);
                }
            }, 300);
        }

        function useBomb(row, col) {
            let rows = board.length, cols = board[0].length;
            let points = 0;
            
            for (let r = Math.max(0, row-1); r <= Math.min(rows-1, row+1); r++) {
                for (let c = Math.max(0, col-1); c <= Math.min(cols-1, col+1); c++) {
                    if (board[r][c] !== null) {
                        points += board[r][c];
                        board[r][c] = null;
                    }
                }
            }
            
            score += points;
            updateProgress();
            showMessage(`ğŸ’£ +${points}`);
            renderBoard();
            
            setTimeout(async () => {
                let { matches, matchGroups } = checkMatches(board);
                if (matches.length > 0) {
                    await removeMatchesAndDrop(board, matches, matchGroups);
                }
            }, 300);
        }

        // ------------------------------------------------------------
        //                     ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        // ------------------------------------------------------------
        function updateProgress() {
            let level = levels[currentLevel];
            let percent = (score / level.target) * 100;
            if (percent > 100) percent = 100;
            document.getElementById('progressFill').style.width = percent + '%';
        }

        // ------------------------------------------------------------
        //                     Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙŠØ©
        // ------------------------------------------------------------
        async function handleCellClick(r, c) {
            if (gamePaused) return;
            
            let level = levels[currentLevel];
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ Ù…Ø¹Ø²Ø²
            let booster = boardBoosters.find(b => b.row === r && b.col === c);
            if (booster) {
                useBoosterFromBoard(r, c, booster);
                return;
            }
            
            // Ø£ÙˆÙ„ Ø§Ø®ØªÙŠØ§Ø±
            if (selectedRow === -1) {
                selectedRow = r;
                selectedCol = c;
                renderBoard();
                return;
            }
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¬Ø§ÙˆØ±
            let rowDiff = Math.abs(r - selectedRow);
            let colDiff = Math.abs(c - selectedCol);
            let isAdjacent = (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1);
            
            if (isAdjacent) {
                // ØªØ¨Ø¯ÙŠÙ„
                [board[r][c], board[selectedRow][selectedCol]] = [board[selectedRow][selectedCol], board[r][c]];
                
                let { matches, matchGroups } = checkMatches(board);
                
                if (matches.length > 0) {
                    await removeMatchesAndDrop(board, matches, matchGroups);
                } else {
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
                    [board[r][c], board[selectedRow][selectedCol]] = [board[selectedRow][selectedCol], board[r][c]];
                    
                    // ØªØ£Ø«ÙŠØ± Ø®Ø·Ø£
                    document.querySelectorAll('.cell').forEach(cell => cell.classList.add('error'));
                    setTimeout(() => document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('error')), 200);
                }
            }
            
            selectedRow = -1;
            selectedCol = -1;
            renderBoard();
        }

        // ------------------------------------------------------------
        //                     Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ­Ø©
        // ------------------------------------------------------------
        function renderBoard() {
            let level = levels[currentLevel];
            let boardDiv = document.getElementById('board');
            
            document.getElementById('levelDisplay').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level.id}`;
            document.getElementById('scoreDisplay').textContent = score;
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            document.getElementById('prevBtn').classList.toggle('disabled', currentLevel === 0);
            document.getElementById('nextBtn').classList.toggle('disabled', 
                currentLevel === levels.length - 1 || !completedLevels.includes(currentLevel));
            
            boardDiv.style.gridTemplateColumns = `repeat(${level.cols}, 70px)`;
            boardDiv.innerHTML = '';
            
            for (let r = 0; r < level.rows; r++) {
                for (let c = 0; c < level.cols; c++) {
                    let cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ø²Ø²
                    let booster = boardBoosters.find(b => b.row === r && b.col === c);
                    
                    if (booster) {
                        cell.classList.add('booster-piece', booster.type);
                        cell.textContent = booster.type === 'arrow' ? 'â¬‡ï¸' : 'ğŸ’£';
                    } else {
                        let num = board[r][c];
                        cell.textContent = num;
                        cell.classList.add(`num-${num}`);
                    }
                    
                    if (selectedRow === r && selectedCol === c && !booster) {
                        cell.classList.add('selected');
                    }
                    
                    cell.onclick = () => handleCellClick(r, c);
                    boardDiv.appendChild(cell);
                }
            }
        }

        // ------------------------------------------------------------
        //                     Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø­Ù„
        // ------------------------------------------------------------
        function nextLevel() {
            if (currentLevel < levels.length - 1 && completedLevels.includes(currentLevel)) {
                currentLevel++;
                resetLevel();
            }
        }

        function prevLevel() {
            if (currentLevel > 0) {
                currentLevel--;
                resetLevel();
            }
        }

        function goToNextLevel() {
            document.getElementById('victoryScreen').style.display = 'none';
            if (currentLevel < levels.length - 1) {
                currentLevel++;
                resetLevel();
            }
        }

        function resetLevel() {
            let level = levels[currentLevel];
            board = createBoard(level);
            score = 0;
            selectedRow = -1;
            selectedCol = -1;
            boardBoosters = [];
            gamePaused = false;
            updateProgress();
            renderBoard();
        }

        function showMessage(text) {
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
            console.log(text);
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        resetLevel();
    </script>
</body>
</html>
