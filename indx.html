<!DOCTYPE html>
<html dir="rtl">
<head>
    <title>Match-3 Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† - Ù…ÙƒØ§ÙØ¢Øª 4 Ùˆ 5</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            user-select: none;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
        }
        
        /* Ø±Ø£Ø³ Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .level-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 25px;
            border-radius: 50px;
            display: inline-block;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ */
        .level-info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .level-name {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-align: center;
        }
        
        .level-shape {
            text-align: center;
            color: #666;
            margin-top: 5px;
        }
        
        /* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #764ba2;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª */
        .boosters-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
        }
        
        .booster {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .booster:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .booster.active {
            border-color: gold;
            background: #fff9e6;
        }
        
        .booster-icon {
            font-size: 28px;
        }
        
        .booster-count {
            font-size: 14px;
            color: #666;
            margin-top: 2px;
            font-weight: bold;
        }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        .board-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: #f0f0f0;
            padding: 20px;
            border-radius: 20px;
        }
        
        .board {
            display: inline-grid;
            gap: 6px;
        }
        
        /* Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
        .cell {
            width: 55px;
            height: 55px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .cell.selected {
            transform: scale(1.1);
            box-shadow: 0 0 0 4px gold, 0 4px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }
        
        .cell:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
        
        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
        .num-1 { background: #FF6B6B; }  /* Ø£Ø­Ù…Ø± ÙØ§ØªØ­ */
        .num-2 { background: #4ECDC4; }  /* ØªØ±ÙƒÙˆØ§Ø² */
        .num-3 { background: #45B7D1; }  /* Ø£Ø²Ø±Ù‚ */
        .num-4 { background: #96CEB4; }  /* Ø£Ø®Ø¶Ø± */
        .num-5 { background: #FFE194; color: #333; }  /* Ø£ØµÙØ± */
        .num-6 { background: #D4A5A5; }  /* ÙˆØ±Ø¯ÙŠ */
        
        /* Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª */
        .cell.obstacle {
            background: #95a5a6 !important;
            cursor: not-allowed;
        }
        
        .cell.obstacle::after {
            content: "â›”";
            position: absolute;
            font-size: 24px;
            opacity: 0.8;
        }
        
        .cell.ice {
            position: relative;
        }
        
        .cell.ice::after {
            content: "â„ï¸";
            position: absolute;
            font-size: 18px;
            top: -5px;
            right: -5px;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
        }
        
        .cell.ice-layer-2::after {
            content: "â„ï¸â„ï¸";
            font-size: 14px;
            top: -8px;
            right: -8px;
        }
        
        .cell.ice-layer-3::after {
            content: "â„ï¸â„ï¸â„ï¸";
            font-size: 12px;
            top: -10px;
            right: -10px;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø²Ø² */
        @keyframes boosterPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        
        .booster-gain {
            animation: boosterPop 0.5s;
        }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© */
        .reward-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: slideDown 0.5s;
        }
        
        @keyframes slideDown {
            0% { transform: translate(-50%, -100px); opacity: 0; }
            100% { transform: translate(-50%, 0); opacity: 1; }
        }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙÙˆØ² */
        .victory-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 30px 50px;
            border-radius: 50px;
            font-size: 32px;
            font-weight: bold;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: popIn 0.5s;
        }
        
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            80% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            flex: 1;
            max-width: 150px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Ø±Ø£Ø³ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div class="game-header">
            <div class="level-badge" id="levelNumber">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1</div>
        </div>
        
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ -->
        <div class="level-info">
            <div class="level-name" id="levelName">ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</div>
            <div class="level-shape" id="levelShape">Ø´ÙƒÙ„: Ù…Ø±Ø¨Ø¹ â€¢ 6Ã—6</div>
        </div>
        
        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="moves">0</div>
                <div class="stat-label">Ø§Ù„Ø­Ø±ÙƒØ§Øª</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="target">1000</div>
                <div class="stat-label">Ø§Ù„Ù‡Ø¯Ù</div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª -->
        <div class="boosters-panel" id="boostersPanel">
            <div class="booster" onclick="selectBooster('arrow')" id="boosterArrow">
                <div class="booster-icon">â¬…ï¸â¡ï¸</div>
                <div class="booster-count" id="arrowCount">0</div>
            </div>
            <div class="booster" onclick="selectBooster('bomb')" id="boosterBomb">
                <div class="booster-icon">ğŸ’£</div>
                <div class="booster-count" id="bombCount">0</div>
            </div>
        </div>
        
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
        <div class="board-container">
            <div class="board" id="board"></div>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="controls">
            <button onclick="prevLevel()">â—€ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button onclick="resetLevel()">Ø¥Ø¹Ø§Ø¯Ø©</button>
            <button onclick="nextLevel()">Ø§Ù„ØªØ§Ù„ÙŠ â–¶</button>
        </div>
    </div>
    
    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© -->
    <div class="reward-message" id="rewardMessage"></div>
    
    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙÙˆØ² -->
    <div class="victory-message" id="victoryMessage">
        ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙØ²Øª Ø¨Ø§Ù„Ù…Ø±Ø­Ù„Ø© ğŸ‰
    </div>

    <script>
        // Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© (1-6)
        const numbers = [1, 2, 3, 4, 5, 6];
        
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
        const levels = [
            {
                // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1: Ù…Ø±Ø¨Ø¹ Ø¹Ø§Ø¯ÙŠ
                id: 1,
                name: 'ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…',
                shape: 'square',
                rows: 6,
                cols: 6,
                target: 500,
                boosters: { arrow: 1, bomb: 0 },
                obstacles: []
            },
            {
                // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2: Ù…Ø±Ø¨Ø¹ Ù…Ø¹ ØµØ®ÙˆØ±
                id: 2,
                name: 'Ø§Ù„Ø¬Ø¨Ù„ Ø§Ù„Ø­Ø¬Ø±ÙŠ',
                shape: 'square',
                rows: 6,
                cols: 6,
                target: 800,
                boosters: { arrow: 0, bomb: 1 },
                obstacles: [
                    { row: 1, col: 1, type: 'rock' },
                    { row: 1, col: 4, type: 'rock' },
                    { row: 3, col: 2, type: 'rock' },
                    { row: 4, col: 5, type: 'rock' },
                    { row: 2, col: 3, type: 'rock' }
                ]
            },
            {
                // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3: Ø´ÙƒÙ„ Ù…Ø«Ù„Ø«
                id: 3,
                name: 'Ù…Ø«Ù„Ø« Ø¨Ø±Ù…ÙˆØ¯Ø§',
                shape: 'triangle',
                rows: 5,
                cols: 5,
                target: 600,
                boosters: { arrow: 0, bomb: 0 },
                obstacles: []
            },
            {
                // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 4: Ø¬Ù„ÙŠØ¯
                id: 4,
                name: 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¬Ù„ÙŠØ¯ÙŠØ©',
                shape: 'square',
                rows: 5,
                cols: 5,
                target: 700,
                boosters: { arrow: 1, bomb: 1 },
                obstacles: [],
                ice: [
                    { row: 0, col: 0, layers: 2 },
                    { row: 0, col: 4, layers: 2 },
                    { row: 2, col: 2, layers: 3 },
                    { row: 4, col: 0, layers: 2 },
                    { row: 4, col: 4, layers: 2 }
                ]
            },
            {
                // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 5: ØµØ¹Ø¨ Ø¬Ø¯Ø§Ù‹
                id: 5,
                name: 'Ù‚Ù„Ø¹Ø© Ø§Ù„ØªØ­Ø¯ÙŠ',
                shape: 'square',
                rows: 6,
                cols: 6,
                target: 1200,
                boosters: { arrow: 0, bomb: 0 },
                obstacles: [
                    { row: 0, col: 2, type: 'rock' },
                    { row: 1, col: 4, type: 'rock' },
                    { row: 2, col: 1, type: 'rock' },
                    { row: 3, col: 3, type: 'rock' },
                    { row: 4, col: 0, type: 'rock' },
                    { row: 5, col: 5, type: 'rock' }
                ],
                ice: [
                    { row: 1, col: 1, layers: 2 },
                    { row: 4, col: 4, layers: 2 }
                ]
            }
        ];
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let currentLevel = 0;
        let board = [];
        let score = 0;
        let moves = 0;
        let selectedRow = -1, selectedCol = -1;
        let boosters = { arrow: 0, bomb: 0 };
        let gameActive = true;
        let selectedBooster = null; // null, 'arrow', 'bomb'
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙˆØ­Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        function createRandomBoard(rows, cols) {
            const newBoard = [];
            for (let r = 0; r < rows; r++) {
                const row = [];
                for (let c = 0; c < cols; c++) {
                    // Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† 1-6
                    const randomNum = numbers[Math.floor(Math.random() * numbers.length)];
                    row.push(randomNum);
                }
                newBoard.push(row);
            }
            return newBoard;
        }
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù…ÙƒØ§ÙØ£Ø©
        function showRewardMessage(text) {
            const msg = document.getElementById('rewardMessage');
            msg.textContent = text;
            msg.style.display = 'block';
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø²Ø²
            if (text.includes('Ø³Ù‡Ù…')) {
                document.getElementById('boosterArrow').classList.add('booster-gain');
                setTimeout(() => {
                    document.getElementById('boosterArrow').classList.remove('booster-gain');
                }, 500);
            } else if (text.includes('Ù‚Ù†Ø¨Ù„Ø©')) {
                document.getElementById('boosterBomb').classList.add('booster-gain');
                setTimeout(() => {
                    document.getElementById('boosterBomb').classList.remove('booster-gain');
                }, 500);
            }
            
            setTimeout(() => {
                msg.style.display = 'none';
            }, 2000);
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·ÙˆÙ„
        function checkMatches(board) {
            const matches = [];
            const matchLengths = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø£Ø·ÙˆØ§Ù„ Ø§Ù„ØªØ·Ø§Ø¨Ù‚Ø§Øª
            const rows = board.length;
            const cols = board[0].length;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø£ÙÙ‚ÙŠ
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols - 2; c++) {
                    if (board[r][c] && board[r][c + 1] && board[r][c + 2] &&
                        board[r][c] === board[r][c + 1] && board[r][c] === board[r][c + 2]) {
                        
                        let matchLength = 3;
                        // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ø§Ø¨Ø¹
                        if (c + 3 < cols && board[r][c] === board[r][c + 3]) {
                            matchLength = 4;
                            // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø®Ø§Ù…Ø³
                            if (c + 4 < cols && board[r][c] === board[r][c + 4]) {
                                matchLength = 5;
                            }
                        }
                        
                        // Ø£Ø¶Ù ÙƒÙ„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø©
                        for (let i = 0; i < matchLength; i++) {
                            matches.push([r, c + i]);
                        }
                        
                        // Ø³Ø¬Ù„ Ø·ÙˆÙ„ Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
                        for (let i = 0; i < matchLength; i++) {
                            matchLengths.push({ row: r, col: c + i, length: matchLength });
                        }
                    }
                }
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ù…ÙˆØ¯ÙŠ
            for (let c = 0; c < cols; c++) {
                for (let r = 0; r < rows - 2; r++) {
                    if (board[r][c] && board[r + 1][c] && board[r + 2][c] &&
                        board[r][c] === board[r + 1][c] && board[r][c] === board[r + 2][c]) {
                        
                        let matchLength = 3;
                        if (r + 3 < rows && board[r][c] === board[r + 3][c]) {
                            matchLength = 4;
                            if (r + 4 < rows && board[r][c] === board[r + 4][c]) {
                                matchLength = 5;
                            }
                        }
                        
                        for (let i = 0; i < matchLength; i++) {
                            matches.push([r + i, c]);
                        }
                        
                        for (let i = 0; i < matchLength; i++) {
                            matchLengths.push({ row: r + i, col: c, length: matchLength });
                        }
                    }
                }
            }
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ù…Ù† matches
            const uniqueMatches = Array.from(new Set(matches.map(JSON.stringify)), JSON.parse);
            
            return { matches: uniqueMatches, matchLengths };
        }
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª ÙˆØ¥Ø³Ù‚Ø§Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        function removeMatches(board, matches, matchLengths) {
            if (matches.length === 0) return false;
            
            const rows = board.length;
            const cols = board[0].length;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
            const removed = Array(rows).fill().map(() => Array(cols).fill(false));
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© ÙˆØ¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª
            matches.forEach(([r, c]) => {
                removed[r][c] = true;
                
                // Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·ÙˆÙ„ Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ù„ÙŠØ©
                const matchInfo = matchLengths.find(m => m.row === r && m.col === c);
                if (matchInfo) {
                    if (matchInfo.length === 4) {
                        // ØªØ·Ø§Ø¨Ù‚ 4 â†’ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø³Ù‡Ù…
                        boosters.arrow++;
                        showRewardMessage('ğŸ¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø³Ù‡Ù…! (ØªØ·Ø§Ø¨Ù‚ 4)');
                    } else if (matchInfo.length === 5) {
                        // ØªØ·Ø§Ø¨Ù‚ 5 â†’ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù‚Ù†Ø¨Ù„Ø©
                        boosters.bomb++;
                        showRewardMessage('ğŸ’£ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ù‚Ù†Ø¨Ù„Ø©! (ØªØ·Ø§Ø¨Ù‚ 5)');
                    }
                }
            });
            
            score += matches.length * 10;
            
            // Ø¥Ø³Ù‚Ø§Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            for (let c = 0; c < cols; c++) {
                for (let r = rows - 1; r >= 0; r--) {
                    if (removed[r][c]) {
                        // Ø¥Ø³Ù‚Ø§Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
                        for (let k = r - 1; k >= 0; k--) {
                            if (!removed[k][c]) {
                                board[r][c] = board[k][c];
                                removed[k][c] = true;
                                removed[r][c] = false;
                                break;
                            }
                        }
                        // Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠ Ø±Ù‚Ù… ÙŠØ³Ù‚Ø·ØŒ Ù†Ù†Ø´Ø¦ Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                        if (removed[r][c]) {
                            board[r][c] = numbers[Math.floor(Math.random() * numbers.length)];
                        }
                    }
                }
            }
            
            return true;
        }
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ù‡Ù…
        function useArrow(row, col, direction) {
            const level = levels[currentLevel];
            const rows = board.length;
            const cols = board[0].length;
            
            if (direction === 'horizontal') {
                // ÙŠØ²ÙŠÙ„ Ø§Ù„ØµÙ ÙƒÙ„Ù‡
                for (let c = 0; c < cols; c++) {
                    if (!level.obstacles || !level.obstacles.some(o => o.row === row && o.col === c)) {
                        board[row][c] = numbers[Math.floor(Math.random() * numbers.length)];
                    }
                }
                showRewardMessage('â¬…ï¸â¡ï¸ Ø³Ù‡Ù… Ø£ÙÙ‚ÙŠ!');
            } else {
                // ÙŠØ²ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙˆØ¯ ÙƒÙ„Ù‡
                for (let r = 0; r < rows; r++) {
                    if (!level.obstacles || !level.obstacles.some(o => o.row === r && o.col === col)) {
                        board[r][col] = numbers[Math.floor(Math.random() * numbers.length)];
                    }
                }
                showRewardMessage('â¬†ï¸â¬‡ï¸ Ø³Ù‡Ù… Ø¹Ù…ÙˆØ¯ÙŠ!');
            }
        }
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ù†Ø¨Ù„Ø©
        function useBomb(row, col) {
            const level = levels[currentLevel];
            const rows = board.length;
            const cols = board[0].length;
            
            // ØªØ²ÙŠÙ„ Ù…Ù†Ø·Ù‚Ø© 3Ã—3 Ø­ÙˆÙ„ Ø§Ù„Ø®Ù„ÙŠØ©
            for (let r = Math.max(0, row - 1); r <= Math.min(rows - 1, row + 1); r++) {
                for (let c = Math.max(0, col - 1); c <= Math.min(cols - 1, col + 1); c++) {
                    if (!level.obstacles || !level.obstacles.some(o => o.row === r && o.col === c)) {
                        board[r][c] = numbers[Math.floor(Math.random() * numbers.length)];
                    }
                }
            }
            showRewardMessage('ğŸ’£ Ø§Ù†ÙØ¬Ø§Ø± Ù‚Ù†Ø¨Ù„Ø©!');
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ­Ø©
        function renderBoard() {
            const level = levels[currentLevel];
            const boardDiv = document.getElementById('board');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
            document.getElementById('levelNumber').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level.id}`;
            document.getElementById('levelName').textContent = level.name;
            document.getElementById('levelShape').textContent = `Ø´ÙƒÙ„: ${level.shape === 'square' ? 'Ù…Ø±Ø¨Ø¹' : 'Ù…Ø«Ù„Ø«'} â€¢ ${level.rows}Ã—${level.cols}`;
            document.getElementById('score').textContent = score;
            document.getElementById('moves').textContent = moves;
            document.getElementById('target').textContent = level.target;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª
            document.getElementById('arrowCount').textContent = boosters.arrow;
            document.getElementById('bombCount').textContent = boosters.bomb;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ø²Ø²Ø§Øª
            document.getElementById('boosterArrow').classList.remove('active');
            document.getElementById('boosterBomb').classList.remove('active');
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø¹Ø²Ø² Ø§Ù„Ù…Ø®ØªØ§Ø±
            if (selectedBooster === 'arrow') {
                document.getElementById('boosterArrow').classList.add('active');
            } else if (selectedBooster === 'bomb') {
                document.getElementById('boosterBomb').classList.add('active');
            }
            
            // Ø¶Ø¨Ø· Ø´ÙƒÙ„ Ø§Ù„Ø´Ø¨ÙƒØ©
            boardDiv.style.gridTemplateColumns = `repeat(${level.cols}, 55px)`;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
            boardDiv.innerHTML = '';
            for (let r = 0; r < level.rows; r++) {
                for (let c = 0; c < level.cols; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙŠØ© Ø¶Ù…Ù† Ø´ÙƒÙ„ Ø§Ù„Ù…Ø«Ù„Ø«
                    if (level.shape === 'triangle' && c > r) {
                        cell.classList.add('obstacle');
                        cell.textContent = '';
                    } else {
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµØ®Ø±Ø©
                        if (level.obstacles && level.obstacles.some(o => o.row === r && o.col === c)) {
                            cell.classList.add('obstacle');
                            cell.textContent = '';
                        } else {
                            const num = board[r][c];
                            cell.textContent = num;
                            cell.classList.add(`num-${num}`);
                            
                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„ÙŠØ¯
                            if (level.ice) {
                                const ice = level.ice.find(i => i.row === r && i.col === c);
                                if (ice) {
                                    cell.classList.add('ice');
                                    if (ice.layers === 2) cell.classList.add('ice-layer-2');
                                    if (ice.layers === 3) cell.classList.add('ice-layer-3');
                                }
                            }
                            
                            // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©
                            if (selectedRow === r && selectedCol === c) {
                                cell.classList.add('selected');
                            }
                        }
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø±
                        cell.onclick = () => handleCellClick(r, c);
                    }
                    
                    boardDiv.appendChild(cell);
                }
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù
            if (score >= level.target) {
                document.getElementById('victoryMessage').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('victoryMessage').style.display = 'none';
                }, 2000);
            }
        }
        
        // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ø²Ø²
        function selectBooster(type) {
            if (boosters[type] > 0) {
                if (selectedBooster === type) {
                    selectedBooster = null; // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                } else {
                    selectedBooster = type; // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø²Ø²
                }
                renderBoard();
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙŠØ©
        function handleCellClick(row, col) {
            if (!gameActive) return;
            
            const level = levels[currentLevel];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµØ®Ø±Ø©
            if (level.obstacles && level.obstacles.some(o => o.row === row && o.col === col)) {
                return;
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ø²Ø² Ù…Ø®ØªØ§Ø±
            if (selectedBooster) {
                if (selectedBooster === 'arrow' && boosters.arrow > 0) {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ù‡Ù…
                    const direction = confirm('Ø§Ø¶ØºØ· OK Ù„Ù„Ø³Ù‡Ù… Ø§Ù„Ø£ÙÙ‚ÙŠØŒ Cancel Ù„Ù„Ø³Ù‡Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ') ? 'horizontal' : 'vertical';
                    useArrow(row, col, direction);
                    boosters.arrow--;
                    selectedBooster = null;
                    moves++;
                    renderBoard();
                    return;
                } else if (selectedBooster === 'bomb' && boosters.bomb > 0) {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ù†Ø¨Ù„Ø©
                    useBomb(row, col);
                    boosters.bomb--;
                    selectedBooster = null;
                    moves++;
                    renderBoard();
                    return;
                }
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ø£ÙˆÙ„ Ø®Ù„ÙŠØ© ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§
            if (selectedRow === -1) {
                selectedRow = row;
                selectedCol = col;
                renderBoard();
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙŠØªÙŠÙ† Ù…ØªØ¬Ø§ÙˆØ±ØªÙŠÙ†
            const rowDiff = Math.abs(row - selectedRow);
            const colDiff = Math.abs(col - selectedCol);
            const isAdjacent = (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1);
            
            if (isAdjacent) {
                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø®Ù„ÙŠØªÙŠÙ†
                const temp = board[row][col];
                board[row][col] = board[selectedRow][selectedCol];
                board[selectedRow][selectedCol] = temp;
                
                moves++;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø·Ø§Ø¨Ù‚Ø§Øª
                const { matches, matchLengths } = checkMatches(board);
                let anyMatch = matches.length > 0;
                
                if (anyMatch) {
                    removeMatches(board, matches, matchLengths);
                    
                    // Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª Ø­ØªÙ‰ Ù„Ø§ ÙŠØ¨Ù‚Ù‰ Ø´ÙŠØ¡
                    let moreMatches;
                    do {
                        const result = checkMatches(board);
                        moreMatches = result.matches;
                        if (moreMatches.length > 0) {
                            removeMatches(board, moreMatches, result.matchLengths);
                        }
                    } while (moreMatches.length > 0);
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ ØªØ·Ø§Ø¨Ù‚ØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
                    const temp = board[row][col];
                    board[row][col] = board[selectedRow][selectedCol];
                    board[selectedRow][selectedCol] = temp;
                    moves--;
                }
            }
            
            // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
            selectedRow = -1;
            selectedCol = -1;
            renderBoard();
        }
        
        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
        function nextLevel() {
            currentLevel = (currentLevel + 1) % levels.length;
            resetLevel();
        }
        
        function prevLevel() {
            currentLevel = (currentLevel - 1 + levels.length) % levels.length;
            resetLevel();
        }
        
        function resetLevel() {
            const level = levels[currentLevel];
            board = createRandomBoard(level.rows, level.cols);
            score = 0;
            moves = 0;
            selectedRow = -1;
            selectedCol = -1;
            selectedBooster = null;
            boosters = { ...level.boosters };
            gameActive = true;
            renderBoard();
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        resetLevel();
    </script>
</body>
</html>
